import{r as a,z as e,a as s,f as t,b as l,w as o,d as n,t as i,e as r,l as c,F as u,u as d,n as f,s as p,h as m,j as h,A as g,c as _}from"./index-BYOr8FGw.js";import{_ as M,a as y}from"./uni-popup.-n1va86X.js";import{_ as v,r as b}from"./useRootFontSize.DZ1_jJ35.js";import{O as k}from"./openBrowserDia.CcgvYxkn.js";import{i as w}from"./shareDia.1GFmX9_J.js";import{g as x}from"./medal.Ccs-KNqs.js";import{u as D}from"./useDayjs.DNfOEY62.js";const C=3.141592653589793,j=6378245,L=.006693421622965943;function S(a,e){return e<72.004||e>137.8347||(a<.8293||a>55.8271)}function Y({lat:a,lon:e,startLat:s,startLon:t,endLat:l,endLon:o}){return!S(a,e)&&(!(e<t||e>o)&&!(a<s||a>l))}function q(a,e){if(S(a,e))return{latitude:a,longitude:e};let s=function(a,e){let s=2*a-100+3*e+.2*e*e+.1*a*e+.2*Math.sqrt(Math.abs(a));return s+=2*(20*Math.sin(6*a*C)+20*Math.sin(2*a*C))/3,s+=2*(20*Math.sin(e*C)+40*Math.sin(e/3*C))/3,s+=2*(160*Math.sin(e/12*C)+320*Math.sin(e*C/30))/3,s}(e-105,a-35),t=function(a,e){let s=300+a+2*e+.1*a*a+.1*a*e+.1*Math.sqrt(Math.abs(a));return s+=2*(20*Math.sin(6*a*C)+20*Math.sin(2*a*C))/3,s+=2*(20*Math.sin(a*C)+40*Math.sin(a/3*C))/3,s+=2*(150*Math.sin(a/12*C)+300*Math.sin(a/30*C))/3,s}(e-105,a-35);const l=a/180*C;let o=Math.sin(l);o=1-L*o*o;const n=Math.sqrt(o);s=180*s/(j*(1-L)/(o*n)*C),t=180*t/(j/n*Math.cos(l)*C);return{latitude:a+s,longitude:e+t}}const z=v({__name:"showMedalDia",props:{themeColor:{type:String,default:"#92d239"},title:{type:String,default:"我的韶山行"}},setup(_,{expose:v}){const{format:C}=D(),j=a(null),L=a(null),S=a(null),Y=()=>{let a=d(S);a={...a,get_time:C(null==S?void 0:S.get_time,"YYYY年MM月DD日")},f({url:`/pages/medalDetail/index?medal=${JSON.stringify(a)}`})},q=()=>{if(w()){B();const a=`${location.origin}/#/pages/download/index`;p({data:a,success:function(){j.value.openBrowser()}})}else f({url:"/pages/download/index"})},z=async a=>{console.log("openMedal",a),await(async a=>{try{let e={page:1,size:10,my_self:!0,task_id:a};const{list:s}=await x(e);s.length>0&&(S.value=s[0])}catch(e){g({title:"获取勋章失败",icon:"none"})}})(a),L.value.open()},B=()=>{L.value.close()};return v({openMedal:z}),(a,d)=>{const f=m,p=h,g=b(e("uni-icons"),M),v=b(e("uni-popup"),y);return s(),t(u,null,[l(v,{ref_key:"showMedalDia",ref:L,class:"medal-dialog","is-mask-click":!1,borderRadius:"12px",type:"dialog"},{default:o((()=>[l(f,{class:"sightsee-content"},{default:o((()=>[l(f,{class:"sightsee-title"},{default:o((()=>[l(f,null,{default:o((()=>[n("🎉打卡成功！")])),_:1}),l(f,null,{default:o((()=>[n("恭喜您在“"+i(_.title)+"”完成打卡！",1)])),_:1})])),_:1}),l(f,{class:"sightsee-medal"},{default:o((()=>[l(f,{class:"sightsee-medal-img"},{default:o((()=>{var a;return[r("img",{src:null==(a=S.value)?void 0:a.url},null,8,["src"])]})),_:1}),l(f,{class:"sightsee-medal-name"},{default:o((()=>{var a;return[n("获得"+i(null==(a=S.value)?void 0:a.name)+"勋章",1)]})),_:1})])),_:1}),l(p,{class:"sightsee-btn f-white",onClick:Y,style:c({backgroundColor:_.themeColor})},{default:o((()=>[n(" 查看勋章 ")])),_:1},8,["style"]),l(p,{onClick:q,style:c({borderColor:_.themeColor}),class:"sightsee-tra-btn f-white"},{default:o((()=>[n(" 下载APP，领取实体勋章 ")])),_:1},8,["style"])])),_:1}),l(f,{class:"medal-dialog-foot"},{default:o((()=>[l(g,{class:"close",onClick:B,type:"close",color:"#fff"})])),_:1})])),_:1},512),l(k,{onClose:z,ref_key:"openBrowserDia",ref:j},null,512)],64)}}},[["__scopeId","data-v-5660231b"]]),B=v({__name:"locationDia",setup(t,{expose:i}){const c=a(null),u=()=>{c.value.close()};return i({openLocation:()=>{c.value.open()}}),(a,t)=>{const i=m,d=b(e("uni-icons"),M),f=b(e("uni-popup"),y);return s(),_(f,{ref_key:"locationDia",ref:c,class:"lux-dialog",borderRadius:"12px","is-mask-click":!1,"background-color":"#fff",type:"dialog"},{default:o((()=>[l(i,{class:"location-content"},{default:o((()=>[l(i,{class:"location-title"},{default:o((()=>[n("请移动到以下范围内进行打卡")])),_:1}),l(i,{class:"location-box"},{default:o((()=>[l(i,{class:"location-circle"}),r("img",{class:"location-img",src:"/static/img/map.png"})])),_:1})])),_:1}),l(d,{class:"close",onClick:u,type:"close",color:"#fff"})])),_:1},512)}}},[["__scopeId","data-v-9101bb4a"]]);export{B as L,z as S,Y as i,q as w};
