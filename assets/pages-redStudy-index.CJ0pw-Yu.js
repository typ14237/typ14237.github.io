import{p as a,r as t,y as s,o as e,z as l,f as i,b as o,u as n,w as c,F as d,h as u,a as r,e as f,d as _,g as p,t as m,G as g,C as k,A as b,I as h,s as y,n as x,i as w,j as v,c as D,q as S,m as j,E as T,B as L,D as C}from"./index-BYOr8FGw.js";import{_ as M,u as A,r as R,a as $}from"./useRootFontSize.DZ1_jJ35.js";import{_ as P}from"./uni-popup.-n1va86X.js";import{u as z,_ as F,a as B,T as H,S as N,b as q}from"./shoppingDia.CVOwmCgK.js";import{H as I,_ as O,O as E}from"./openBrowserDia.CcgvYxkn.js";import{_ as G}from"./logo.Bw7MxNqG.js";import{u as X,M as U,p as J,S as K,i as Q,n as V,a as W}from"./shareDia.1GFmX9_J.js";import{u as Y,g as Z,a as aa}from"./task.CgdnYoNG.js";import{u as ta,L as sa,R as ea}from"./loginDia.CoHUHVAR.js";import{S as la,L as ia,w as oa,i as na}from"./locationDia.Bnk-JiBT.js";import{u as ca}from"./medal.Ccs-KNqs.js";import{u as da}from"./useDayjs.DNfOEY62.js";const ua=M({__name:"index",setup(M){const ua=Y(),{needLogin:ra}=T(),{loginStatus:fa}=a(ta()),{goods:_a}=z(),{medalImgs:pa,medalPath:ma}=a(X()),{rootFontSize:ga}=A(),{format:ka}=da(),{tableData:ba,getTableData:ha}=ca(Z,{initParam:{project:"study"},dataCallBack:a=>{let t=null==a?void 0:a.list;t&&t.length>0&&(t=t.forEach((a=>{"check_in"===a.task_type&&(a.disable=!1)})))}}),ya=t(null),xa=t(null),wa=t(null),va=t(null),Da=t(null),Sa=t(null),ja=t(null),Ta=[{desc:"记录美好瞬间",src:"/static/img/red-study/feature1.png"},{desc:"成就上链储存",src:"/static/img/red-study/feature2.png"},{desc:"量化日常生活",src:"/static/img/red-study/feature3.png"}];s(ra,(a=>{a&&za()})),s((()=>ua.redFulfilNum),((a,t)=>{a===ua.redStudyTask.length&&0!==t&&g((()=>{Fa()}))})),s(fa,(async a=>{await La()})),e((async()=>{}));const La=async()=>{await ha();const a=n(ba)[0];ua.updateActivity(a),ua.updateTaskList("redStudyTask",null==a?void 0:a.children)},Ca=()=>{ja.value.openRule()},Ma=()=>{Da.value.openLocation()},Aa=()=>{va.value.openShopping()},Ra=()=>{k({type:"wgs84",success:async function(a){console.log("当前位置的经度："+a.longitude),console.log("当前位置的纬度："+a.latitude);const t=oa(a.latitude,a.longitude);console.log("转换后的坐标：",t)},fail:function(a){b({title:"设备不支持该功能",icon:"none"})}})},$a=()=>!!h()||(za(),!1),Pa=()=>{if(Q()){const a=`${location.origin}/#/pages/download/index`;y({data:a,success:function(){ya.value.openBrowser()}})}else x({url:"/pages/download/index"})},za=()=>{xa.value.openLogin()},Fa=()=>{wa.value.openMedal(ua.activity.id)};return(a,t)=>{const s=R(l("page-meta"),$),e=u,g=w,h=v,y=R(l("uni-icons"),P);return r(),i(d,null,[o(s,{"root-font-size":n(ga)},null,8,["root-font-size"]),o(e,{class:"content-wrapper"},{default:c((()=>[o(I,{onLogin:$a,onOpenRule:Ca}),o(e,{class:"content-header"},{default:c((()=>[f("img",{class:"header-top-border",src:F}),o(e,{class:"header-content"},{default:c((()=>[o(e,{class:"header-title"},{default:c((()=>[o(e,{class:"title-text1 text-pos1"},{default:c((()=>[_("我的")])),_:1}),o(e,{class:"title-text1 text-pos2"},{default:c((()=>[_("韶山行")])),_:1}),o(e,{class:"title-text2 text-pos3 no-rem-text-stroke-black"},{default:c((()=>[_(" 韶山 ")])),_:1}),o(e,{class:"title-text2 text-pos4"},{default:c((()=>[_("Going out")])),_:1}),o(e,{class:"title-text2 text-pos5"},{default:c((()=>[_("SHAOSHAN")])),_:1}),o(e,{class:"title-text2 text-pos6"},{default:c((()=>[_("打卡得勋章")])),_:1})])),_:1}),o(e,{class:"header-card"},{default:c((()=>[o(U,{class:"model",width:n(J)("200px"),height:n(J)("200px"),scaleFactor:3,isScale:!1,isRoll:!1,path:n(ma)},null,8,["width","height","path"]),o(e,{class:"activity-box"},{default:c((()=>[o(e,null,{default:c((()=>[(r(),i(d,null,p(3,(a=>f("img",{key:a,class:"avatar",src:`/static/img/avatar${a}.png`},null,8,["src"]))),64))])),_:1}),o(e,{class:"user"},{default:c((()=>[o(g,null,{default:c((()=>[_(m(`{ ${n(ua).userNum}名用户已参与 }`),1)])),_:1}),o(g,{class:"t-bg bg-light-brown t-bg-pos"})])),_:1}),o(e,{class:"activity-time"},{default:c((()=>[o(g,null,{default:c((()=>[_("本期活动时间：")])),_:1}),f("br"),o(g,{class:"t-18"},{default:c((()=>[_(m(`${n(ka)(n(ua).activity.create_at,"MM.DD")}-${n(ka)(n(ua).activity.end_time,"MM.DD")}`),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(e,{class:"header-footer"},{default:c((()=>[f("img",{class:"header-bottom-border",src:B}),o(e,{class:"header-footer-fill1"}),o(e,{class:"header-footer-fill2"})])),_:1})])),_:1}),o(e,{class:"main pad-16"},{default:c((()=>[o(e,{class:"task-box"},{default:c((()=>[o(e,{class:"task-box1"},{default:c((()=>[o(e,{class:"task-num"},{default:c((()=>[o(g,{class:"f-white no-rem-text-stroke-black"},{default:c((()=>[_(" 当前任务需要完成 ")])),_:1}),o(g,{class:"f-light-brown no-rem-text-stroke-black"},{default:c((()=>[_(m(n(ua).redStudyTask.length)+"个打卡 ",1)])),_:1})])),_:1}),o(e,{class:"task-text"},{default:c((()=>[o(g,{class:"task"},{default:c((()=>[_(" 已完成"+m(n(ua).redFulfilNum)+"/"+m(n(ua).redStudyTask.length)+"个任务 ",1)])),_:1}),o(g,{class:"t-bg bg-light-brown task-t-bg"})])),_:1})])),_:1})])),_:1}),o(e,{class:"task-place-list"},{default:c((()=>[(r(!0),i(d,null,p(n(ua).redStudyTask,((a,t)=>(r(),D(e,{class:"task-place-item"},{default:c((()=>[o(H,{subtitle:`第${n(V)(t+1)}篇章`,title:a.name},null,8,["subtitle","title"]),o(e,{class:"task-place-content"},{default:c((()=>[o(e,{class:"scenic-box"},{default:c((()=>[f("img",{class:"scenic",src:a.picture_url},null,8,["src"])])),_:2},1024),o(e,{class:"task-place-desc"},{default:c((()=>[o(e,{class:"task-place-title"},{default:c((()=>[_("篇章内容")])),_:1}),o(e,{class:"t-w-normal",innerHTML:a.description},null,8,["innerHTML"])])),_:2},1024),"check_in"===a.task_type?(r(),D(h,{key:0,onClick:t=>(async a=>{if("end"===ua.activeStatus)return void b({title:"当前活动已结束",icon:"none"});if(!$a())return;if(a.is_finished)return;if(!W())return void b({title:"您的设备不支持定位",icon:"none"});L({title:"正在打卡..."});const{detail:t}=await aa(a.id);k({type:"wgs84",success:async function(s){console.log("当前位置的经度："+s.longitude),console.log("当前位置的纬度："+s.latitude);const e=oa(s.latitude,s.longitude);console.log("转换后的坐标：",e);let l={lat:e.latitude,lon:e.longitude,startLat:t.start_latitude,startLon:t.start_longitude,endLat:t.end_latitude,endLon:t.end_longitude};const i=na(l);i&&(await ua.doneTask(a.id,e),await La()),ua.changeTaskDisable("redStudyTask",a.id,!i)},fail:function(a){b({title:"设备不支持该功能",icon:"none"})}}),C()})(a),class:S([a.disable?"sightsee-disable":"","red-btn f-white"])},{default:c((()=>[_(m(a.is_finished?"已打卡":"立即打卡"),1)])),_:2},1032,["onClick","class"])):j("",!0),"question"===a.task_type?(r(),D(h,{key:1,onClick:t=>(async a=>{if(!$a())return;if(a.is_finished)return;const t=ua.activity.name;x({url:`/pages/answer/index?id=${a.id}&title=${t}`})})(a),class:"red-btn f-white"},{default:c((()=>[_(m(a.is_finished?"已答题":"开始答题"),1)])),_:2},1032,["onClick"])):j("",!0),"check_in"===a.task_type&&a.disable?(r(),D(e,{key:2,onClick:Ma,class:"task-tip pointer"},{default:c((()=>[_(" 当前不在打卡范围内，查看打卡范围 "),o(y,{type:"right",color:"#ccc",size:"12"})])),_:1})):j("",!0),"question"===a.task_type?(r(),D(e,{key:3,class:"task-tip pointer"},{default:c((()=>[_(" 完成答题即可完成打卡 ")])),_:1})):j("",!0)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),o(e,{class:"mar-top-36"},{default:c((()=>[o(H,{subtitle:"PART 01",title:"勋章故事"}),o(e,{class:"item-bg2"},{default:c((()=>[o(e,{class:"medal-box"},{default:c((()=>[o(e,{class:"medal-story"},{default:c((()=>[o(e,{class:"medal-display"},{default:c((()=>[o(e,{class:"medal-title f-white"},{default:c((()=>[_("革命足迹勋章")])),_:1}),o(e,{class:"medals"},{default:c((()=>[(r(!0),i(d,null,p(n(pa),(a=>(r(),i("img",{src:a.src,key:a.name},null,8,["src"])))),128))])),_:1})])),_:1}),o(e,{class:"bg-introduce-box"},{default:c((()=>[o(e,{class:"title1 f-white"},{default:c((()=>[_("背景介绍")])),_:1}),o(e,{class:"bg-introduce f-white"},{default:c((()=>[o(e,{class:"indent-1"},{default:c((()=>[_(" 勋章正面雕刻着一个动物肖像，背景则是韶山的山水田园，象征着他的出生地和革命思想的初步孕育。勋章的左侧刻有岳麓书院的古建筑轮廓。 ")])),_:1}),f("br"),o(e,{class:"indent-1"},{default:c((()=>[_(' 勋章的边缘镌刻着"革命的足迹，历史的见证”以及参与此次研学旅行的日期。此外，勋章的材质选择了青铜色合金，增加了历史感和庄重感。 ')])),_:1})])),_:1})])),_:1}),o(e,{class:"medal-introduce-box"},{default:c((()=>[o(e,{class:"title1 f-white",style:{"margin-bottom":"12px"}},{default:c((()=>[_(" 勋章介绍 ")])),_:1}),o(e,{class:"medal-introduce"},{default:c((()=>[o(e,{class:"title2"},{default:c((()=>[_("橘子洲勋章")])),_:1}),o(e,{class:"medal-desc-box transform-r-15"},{default:c((()=>[f("img",{src:O}),o(e,{class:"medal-param1"},{default:c((()=>[o(e,{class:"medal-param1-text"},{default:c((()=>[_(" 圆形 5 X 5(cm) "),f("br"),_(" 50g "),f("br"),_(" 铝合金 "),f("br"),_(" 长沙市煋翘数字科技有限公司 ")])),_:1})])),_:1})])),_:1}),o(e,{class:"medal-desc indent-1 f-white"},{default:c((()=>[_(" “革命足迹勋章”是专为参加“追寻革命先辈步伐”研学旅行的学生设计的。勋章的设计灵感来源于毛泽东青年时期的革命历程，象征着从韶山到岳麓书院再到橘子洲头的精神历程。 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(e,{class:"goods-box mar-top-36"},{default:c((()=>[o(H,{subtitle:"PART 02",title:"研学周边"}),o(e,{class:"item-bg"},{default:c((()=>[o(e,{class:"goods-list"},{default:c((()=>[(r(!0),i(d,null,p(n(_a),(a=>(r(),D(e,{onClick:Aa,class:"goods-item",key:a.name},{default:c((()=>[f("img",{src:a.src},null,8,["src"]),o(e,{class:"goods-desc"},{default:c((()=>[o(e,{class:"goods-name"},{default:c((()=>[_(m(a.name),1)])),_:2},1024),o(e,{class:"goods-price"},{default:c((()=>[o(g,{class:"signal"},{default:c((()=>[_("￥")])),_:1}),_(" "+m(a.price)+" ",1),o(e,{class:"shopping"},{default:c((()=>[_(" 立即购买 "),o(g,{class:"arrow"},{default:c((()=>[f("img",{src:q})])),_:1})])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),o(e,{class:"download-box mar-top-36"},{default:c((()=>[o(H,{subtitle:"PART 03",title:"人生成就有限公司"}),o(e,{class:"download-desc"},{default:c((()=>[o(e,{class:"app-name-box"},{default:c((()=>[f("img",{src:G,alt:""}),o(g,{class:"app-name"},{default:c((()=>[_("LUX  |  人生成就有限公司")])),_:1})])),_:1}),o(e,{class:"app-feature-list"},{default:c((()=>[(r(),i(d,null,p(Ta,((a,t)=>o(e,{class:"app-feature",key:t},{default:c((()=>[f("img",{src:a.src},null,8,["src"]),o(e,null,{default:c((()=>[_(m(a.desc),1)])),_:2},1024)])),_:2},1024))),64))])),_:1}),o(e,{class:"download-btn-box"},{default:c((()=>[o(h,{onClick:Pa,class:"red-btn f-white"},{default:c((()=>[_(" 下载APP，体验完整版 ")])),_:1})])),_:1})])),_:1})])),_:1}),o(e,null,{default:c((()=>[o(h,{onClick:Ra},{default:c((()=>[_("定位")])),_:1})])),_:1}),o(e,{class:"foot-tip"},{default:c((()=>[_(" *本次活动解释权归长沙市煋翘数字科技有限公司所有 ")])),_:1})])),_:1})])),_:1}),o(sa,{ref_key:"loginDia",ref:xa},null,512),o(E,{ref_key:"openBrowserDia",ref:ya},null,512),o(la,{themeColor:"#ae292f",ref_key:"showMedalDia",ref:wa},null,512),o(N,{ref_key:"shoppingDia",ref:va},null,512),o(ia,{ref_key:"locationDia",ref:Da},null,512),o(K,{ref_key:"shareDia",ref:Sa},null,512),o(ea,{ref_key:"ruleDia",ref:ja},null,512)],64)}}},[["__scopeId","data-v-e56a2e01"]]);export{ua as default};
